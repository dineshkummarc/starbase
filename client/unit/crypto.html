<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<script src="http://code.jquery.com/jquery-latest.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" 
  type="text/css" media="screen" />
<script src="http://code.jquery.com/qunit/git/qunit.js"></script>

<script src="../libs/bigint-5.4.min.js"></script>
<script src="../starbase.js"></script>
<script src="../crypto.js"></script>

<script>
$(document).ready(function(){

module("diffie hellman key exchange functions");

// all values are taken from http://tools.ietf.org/html/rfc5114#appendix-A.3

test("public key calculation", function() 
{
  expect(2);
  // secret keys
  var xA = "0881382CDB87660C6DC13E614938D5B9C8B2F248581CC5E31B35454397FCE50E";
  var xB = "7D62A7E3EF36DE617B13D1AFB82C780D83A23BD4EE6705645121F371F546A53D";
  
  // public keys we expect to calculate
  var yA = "2E9380C8323AF97545BC4941DEB0EC37" +
           "42C62FE0ECE824A6ABDBE66C59BEE0242911BFB967235CEB" +
           "A35AE13E4EC752BE630B92DC4BDE2847A9C62CB815274542" +
           "1FB7EB60A63C0FE9159FCCE726CE7CD8523D7450667EF840" +
           "E4919121EB5F01C8C9B0D3D648A93BFB75689E8244AC134A" +
           "F544711CE79A02DCC34226684780DDDCB498594106C37F5B" +
           "C79856487AF5AB022A2E5E42F09897C1A85A11EA0212AF04" +
           "D9B4CEBC937C3C1A3E15A8A0342E337615C84E7FE3B8B9B8" +
           "7FB1E73A15AF12A30D746E06DFC34F290D797CE51AA13AA7" +
           "85BF6658AFF5E4B093003CBEAF665B3C2E113A3A4E905269" +
           "341DC0711426685F4EF37E868A8126FF3F2279B57CA67E29";
           
  var yB = "575F0351BD2B1B817448BDF87A6C362C" +
           "1E289D3903A30B9832C5741FA250363E7ACBC7F77F3DACBC" +
           "1F131ADD8E03367EFF8FBBB3E1C5784424809B25AFE4D226" +
           "2A1A6FD2FAB64105CA30A674E07F7809852088632FC04923" +
           "3791AD4EDD083A978B883EE618BC5E0DD047415F2D95E683" +
           "CF14826B5FBE10D3CE41C6C120C78AB20008C698BF7F0BCA" +
           "B9D7F407BED0F43AFB2970F57F8D12043963E66DDD320D59" +
           "9AD9936C8F44137C08B180EC5E985CEBE186F3D549677E80" +
           "607331EE17AF3380A725B0782317D7DD43F59D7AF9568A9B" +
           "B63A84D365F92244ED120988219302F42924C7CA90B89D24" +
           "F71B0AB697823D7DEB1AFF5B0E8E4A45D49F7F53757E1913";

  equal(starbase.crypto.dh.generate_publickey(xA), yA, "1st example ok"); 
  equal(starbase.crypto.dh.generate_publickey(xB), yB, "2nd example ok"); 

});


test("secret shared key calculation", function() 
{
  expect(2);
  
  // secret keys
  var xA = "0881382CDB87660C6DC13E614938D5B9C8B2F248581CC5E31B35454397FCE50E";
  var xB = "7D62A7E3EF36DE617B13D1AFB82C780D83A23BD4EE6705645121F371F546A53D";
  
  // public keys we calculated before
  var yA = "2E9380C8323AF97545BC4941DEB0EC37" +
           "42C62FE0ECE824A6ABDBE66C59BEE0242911BFB967235CEB" +
           "A35AE13E4EC752BE630B92DC4BDE2847A9C62CB815274542" +
           "1FB7EB60A63C0FE9159FCCE726CE7CD8523D7450667EF840" +
           "E4919121EB5F01C8C9B0D3D648A93BFB75689E8244AC134A" +
           "F544711CE79A02DCC34226684780DDDCB498594106C37F5B" +
           "C79856487AF5AB022A2E5E42F09897C1A85A11EA0212AF04" +
           "D9B4CEBC937C3C1A3E15A8A0342E337615C84E7FE3B8B9B8" +
           "7FB1E73A15AF12A30D746E06DFC34F290D797CE51AA13AA7" +
           "85BF6658AFF5E4B093003CBEAF665B3C2E113A3A4E905269" +
           "341DC0711426685F4EF37E868A8126FF3F2279B57CA67E29";
           
  var yB = "575F0351BD2B1B817448BDF87A6C362C" +
           "1E289D3903A30B9832C5741FA250363E7ACBC7F77F3DACBC" +
           "1F131ADD8E03367EFF8FBBB3E1C5784424809B25AFE4D226" +
           "2A1A6FD2FAB64105CA30A674E07F7809852088632FC04923" +
           "3791AD4EDD083A978B883EE618BC5E0DD047415F2D95E683" +
           "CF14826B5FBE10D3CE41C6C120C78AB20008C698BF7F0BCA" +
           "B9D7F407BED0F43AFB2970F57F8D12043963E66DDD320D59" +
           "9AD9936C8F44137C08B180EC5E985CEBE186F3D549677E80" +
           "607331EE17AF3380A725B0782317D7DD43F59D7AF9568A9B" +
           "B63A84D365F92244ED120988219302F42924C7CA90B89D24" +
           "F71B0AB697823D7DEB1AFF5B0E8E4A45D49F7F53757E1913";

  // key we expect to calculate
  var Z = "86C70BF8D0BB81BB01078A17219CB7D2" +
           "7203DB2A19C877F1D1F19FD7D77EF22546A68F005AD52DC8" +
           "4553B78FC60330BE51EA7C0672CAC1515E4B35C047B9A551" +
           "B88F39DC26DA14A09EF74774D47C762DD177F9ED5BC2F11E" +
           "52C879BD95098504CD9EECD8A8F9B3EFBD1F008AC5853097" +
           "D9D1837F2B18F77CD7BE01AF80A7C7B5EA3CA54CC02D0C11" +
           "6FEE3F95BB87399385875D7E86747E676E728938ACBFF709" +
           "8E05BE4DCFB24052B83AEFFB14783F029ADBDE7F53FAE920" +
           "84224090E007CEE94D4BF2BACE9FFD4B57D2AF7C724D0CAA" +
           "19BF0501F6F17B4AA10F425E3EA76080B4B9D6B3CEFEA115" +
           "B2CEB8789BB8A3B0EA87FEBE63B6C8F846EC6DB0C26C5D7C";
           
  equal(starbase.crypto.dh.generate_sharedsecret(xA, yB), Z, "1st example ok"); 
  equal(starbase.crypto.dh.generate_sharedsecret(xB, yA), Z, "2nd example ok"); 

});


});
</script>
  
</head>
<body>
  <h1 id="qunit-header">Starbase Crypto Unit Test</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
